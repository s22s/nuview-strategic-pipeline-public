<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <meta name="description" content="NUVIEW Strategic Pipeline - Scripts Documentation">
    <meta name="theme-color" content="#001F3F">
    
    <title>Scripts Documentation - NUVIEW Strategic Pipeline</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <style>
        /* ============================================
           NUVIEW SPACEX-INSPIRED THEME - CSS VARIABLES
           ============================================
           
           PURPOSE:
           SpaceX-inspired deep space-black theme with minimal accent red.
           Red is used ONLY for highlights: active states, badges, borders.
           Regular text uses clean off-greys and whites for readability.
           
           DESIGN PRINCIPLES:
           - Deep space-black backgrounds (#000, #0a0a0a, #1a1a1a)
           - Clean, high-contrast text (white/off-grey)
           - Accent red (#E10600) for highlights only
           - Modern card-style sections with soft shadows
           - Bold headers with subtle drop shadows
           - Mobile-friendly responsive design
           
           LAST UPDATED: 2025-11-21
           ============================================ */
        
        :root { 
            --nuview-red: #E10600; 
            --nuview-black: #000000;
            --nuview-space-dark: #0a0a0a;
            --nuview-space-medium: #1a1a1a;
            --nuview-space-light: #2a2a2a;
            --nuview-white: #ffffff;
            --text-primary: #ffffff;
            --text-secondary: #e0e0e0;
            --text-tertiary: #b0b0b0;
            --border-primary: #2a2a2a;
        }
        
        body { 
            font-family: 'Inter', sans-serif; 
            background: linear-gradient(135deg, var(--nuview-black) 0%, var(--nuview-space-dark) 50%, var(--nuview-black) 100%); 
            color: var(--text-primary); 
            margin: 0; 
            padding: 0; 
        }
        .sidebar { 
            position: fixed; 
            left: 0; 
            top: 0; 
            height: 100%; 
            width: 260px; 
            background: linear-gradient(180deg, var(--nuview-space-dark) 0%, var(--nuview-black) 100%); 
            box-shadow: 4px 0 24px rgba(0,0,0,0.8); 
            z-index: 100; 
            border-right: 2px solid var(--nuview-red); 
            padding-top: 2rem; 
            overflow-y: auto; 
        }
        .sidebar h3 {
            padding-left: 1rem;
            color: var(--nuview-white);
            font-weight: 800;
            font-size: 1.1rem;
            margin-bottom: 1rem;
        }
        .sidebar a { 
            color: var(--text-secondary); 
            text-decoration: none; 
            display: block; 
            padding: 0.75rem 1.25rem; 
            margin: 0.25rem 0.5rem; 
            border-radius: 8px;
            transition: all 0.3s ease;
            font-weight: 500;
        }
        .sidebar a:hover { 
            background: linear-gradient(90deg, rgba(225, 6, 0, 0.1) 0%, rgba(255, 255, 255, 0.05) 100%); 
            color: var(--nuview-white); 
            border-left: 3px solid var(--nuview-red); 
            padding-left: 1rem;
            transform: translateX(4px);
        }
        .sidebar a.active { 
            background: linear-gradient(90deg, var(--nuview-red) 0%, rgba(225, 6, 0, 0.2) 100%); 
            color: var(--nuview-white); 
            border-left: 3px solid var(--nuview-white); 
            font-weight: 600;
        }
        .main-content { 
            margin-left: 260px; 
            padding: 30px; 
            min-height: 100vh; 
            background: var(--nuview-black);
        }
        .header { 
            background: linear-gradient(135deg, var(--nuview-black) 0%, var(--nuview-space-dark) 100%); 
            color: var(--nuview-white); 
            padding: 2rem 0; 
            text-align: center; 
            border-bottom: 3px solid var(--nuview-red); 
            box-shadow: 0 8px 32px rgba(0,0,0,0.6); 
            border-radius: 16px;
            margin-bottom: 2rem;
        }
        .header-logo {
            font-size: 2rem;
            font-weight: 800;
            letter-spacing: 2px;
            margin-bottom: 0.5rem;
            background: linear-gradient(90deg, var(--nuview-white) 0%, var(--nuview-red) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .section { 
            background: linear-gradient(180deg, var(--nuview-space-dark) 0%, var(--nuview-space-medium) 100%); 
            border-radius: 16px; 
            padding: 2rem; 
            margin: 2rem 0; 
            box-shadow: 0 12px 40px rgba(0,0,0,0.8); 
            border: 1px solid var(--border-primary);
            transition: all 0.3s ease;
        }
        .section:hover {
            box-shadow: 0 16px 48px rgba(0,0,0,0.9), 0 0 0 1px var(--nuview-red);
            transform: translateY(-2px);
        }
        .section h2 { 
            color: var(--nuview-white); 
            border-bottom: 3px solid var(--nuview-red); 
            padding-bottom: 0.75rem; 
            margin-bottom: 1.5rem; 
            font-size: 1.75rem; 
            font-weight: 700;
        }
        @supports (background-clip: text) or (-webkit-background-clip: text) {
            .section h2 {
                background: linear-gradient(90deg, var(--nuview-white) 0%, var(--nuview-red) 100%);
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
                background-clip: text;
            }
        }
        .section h3 {
            color: var(--nuview-white);
            margin-top: 1.5rem;
            margin-bottom: 1rem;
            font-size: 1.3rem;
            font-weight: 600;
        }
        .info-box {
            background: linear-gradient(135deg, rgba(225, 6, 0, 0.05) 0%, rgba(0, 0, 0, 0.2) 100%);
            padding: 1.5rem;
            border-radius: 12px;
            margin-bottom: 1.5rem;
            border-left: 4px solid var(--nuview-red);
        }
        .info-box p {
            color: var(--text-secondary);
            line-height: 1.6;
            margin-bottom: 0.5rem;
        }
        .code-block {
            background: #282c34;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1rem 0;
            overflow-x: auto;
            border-left: 4px solid var(--nuview-red);
        }
        .code-block pre {
            margin: 0;
            color: #abb2bf;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            line-height: 1.5;
        }
        .code-block code {
            color: #abb2bf;
        }
        .command-box {
            background: linear-gradient(135deg, var(--nuview-black) 0%, var(--nuview-space-dark) 100%);
            color: var(--nuview-white);
            padding: 1rem 1.5rem;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            margin: 1rem 0;
            font-weight: 600;
            border: 1px solid var(--nuview-red);
        }
        .script-description {
            background: var(--nuview-space-medium);
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            border-left: 3px solid var(--nuview-red);
        }
        @media (max-width: 768px) {
            .sidebar {
                width: 100%;
                height: auto;
                position: relative;
                border-right: none;
                border-bottom: 3px solid var(--nuview-red);
            }
            .main-content {
                margin-left: 0;
                padding: 15px;
            }
            .code-block {
                font-size: 0.75rem;
            }
        }
    </style>
</head>
<body>

<nav class="sidebar">
    <h3>BUSINESS DEVELOPMENT</h3>
    <a href="index.html"><i class="bi bi-briefcase"></i> Executive Overview</a>
    <a href="executive-summary.html"><i class="bi bi-file-earmark-text"></i> Executive Summary</a>
    <a href="scripts-documentation.html" class="active"><i class="bi bi-code-slash"></i> Scripts Documentation</a>
    <a href="pipeline.html"><i class="bi bi-funnel"></i> Pipeline Tracker</a>
    <a href="pipeline_matrix.html"><i class="bi bi-diagram-3"></i> Strategic Matrix</a>
    <a href="global-tracker.html"><i class="bi bi-globe"></i> Global Tracker</a>
</nav>

<main class="main-content">
    <header class="header">
        <div class="header-logo">NUVIEW</div>
        <h1>Scripts Documentation</h1>
        <p>Pipeline Scripts for Generating the Executive Summary</p>
    </header>

    <div class="section">
        <h2><i class="bi bi-code-slash"></i> Core Pipeline Scripts</h2>
        
        <div class="info-box">
            <p>
                <strong>Overview:</strong> These are the core pipeline scripts to scrape, QC, score, and generate the summary table. 
                The scripts work together to collect data from various sources, validate and merge it, and produce the priority matrix 
                that powers the dashboard.
            </p>
            <p>
                <strong>Quick Start:</strong> Run the following commands to update the data:
            </p>
            <div class="command-box">
                python scripts/run_all.py && python scripts/qc/validate_and_merge.py
            </div>
            <p>
                This will generate <code>data/processed/priority_matrix.csv</code>, which the dashboard uses to render the summary.
            </p>
        </div>

        <h3><i class="bi bi-gear"></i> 1. Global Keywords Module</h3>
        <div class="script-description">
            <strong>File:</strong> <code>scripts/scrapers/global_keywords.py</code><br>
            <strong>Purpose:</strong> Multilingual topographic keyword matching for identifying relevant programs across different languages and regions.
        </div>
        <div class="code-block">
            <pre><code class="language-python">import re

TOPOGRAPHIC_KEYWORDS = re.compile(
    r'\b(3dep|topographic\s*lidar|bare\s*earth|bareearth|dem|dsm|dtm|digital\s*elevation\s*model|'
    r'digital\s*surface\s*model|digital\s*terrain\s*model|ql1|ql2|ahn\d?|lidar\s*hd|dgm|dom|dhm|'
    r'mnt|mns|modèle\s*numérique\s*de\s*(terrain|surface)|'
    r'mdt|mds|mde|modelo\s*digital\s*de\s*(elevación|terreno|superficie)|'
    r'nmt|nmp|numeryczny\s*model\s*(terenu|pokrycia)|'
    r'saydm|yükseklik\s*sayısal\s*modeli|nationell\s*höjdmodell|nhm|ny\s*nationell\s*höjdmodell|höjdmodell|'
    r'korkeusmalli|maastomalli|modello\s*digitale\s*del\s*terreno|dbm|'
    r'modelo\s*digital\s*do\s*terreno|цифровая\s*модель\s*рельефа|цмр|'
    r'数字高程模型|数字表面模型|수치표고모델|수치지형모델|数値標高モデル|数値表面モデル)\b',
    re.I | re.UNICODE
)

BATHY_IGNORE = re.compile(r'\b(bathymetric|topobathy|coastal\s*water|underwater)\b', re.I)</code></pre>
        </div>

        <h3><i class="bi bi-play-circle"></i> 2. Run All Scrapers</h3>
        <div class="script-description">
            <strong>File:</strong> <code>scripts/run_all.py</code><br>
            <strong>Purpose:</strong> Orchestrates 34 scrapers across multiple countries and agencies to collect comprehensive data.
        </div>
        <div class="code-block">
            <pre><code class="language-python">import json
from pathlib import Path
from importlib import import_module

SCRAPERS = [
    "usgs", "ign_france", "ordnance_survey", "geoscience_australia", "nrcan_canada",
    "kadaster_netherlands", "bkg_germany", "gsi_japan", "nasa", "esa", "diu", "ussf", "jaxa",
    "sweden_lantmateriet", "switzerland_swisstopo", "norway_kartverket", "finland_nls",
    "poland_gugik", "italy_igmi", "spain_ign", "portugal_dgt", "austria_bev", "czech_cuzk",
    "turkey_harita", "brazil_ibge", "argentina_ign", "chile_igm", "colombia_igac",
    "peru_ign", "mexico_inegi", "southafrica_ngi", "newzealand_linz", "southkorea_ngii", "india_soi"
]

def run_all():
    records = []
    for name in SCRAPERS:
        try:
            module = import_module(f"scripts.scrapers.{name}")
            records.extend(module.scrape())
            print(f"{name}: Fetched {len(module.scrape())} records")
        except ImportError as e:
            print(f"{name}: Skipped - {e}")
    
    Path("data/interim").mkdir(parents=True, exist_ok=True)
    Path("data/interim/all_raw.json").write_text(json.dumps(records, indent=2, ensure_ascii=False))
    print(f"Raw data written: {len(records)} records")

if __name__ == "__main__":
    run_all()</code></pre>
        </div>

        <h3><i class="bi bi-check-circle"></i> 3. Validation and Merge</h3>
        <div class="script-description">
            <strong>File:</strong> <code>scripts/qc/validate_and_merge.py</code><br>
            <strong>Purpose:</strong> Validates scraped data, calculates priority scores, and generates the priority matrix CSV.
        </div>
        <div class="code-block">
            <pre><code class="language-python">import json
from pathlib import Path
from datetime import datetime
import pandas as pd

RAW_PATH = Path("data/interim/all_raw.json")
CANONICAL_PATH = Path("data/processed/programs.json")
MATRIX_PATH = Path("data/processed/priority_matrix.csv")

def calculate_priority(rec):
    score = min(rec["budget_amount_usd"] / 1e6 * 0.5, 50)  # Scale
    score += len(rec["keywords"]) * 4  # Density
    score += 15 if "open" in rec["data_access"].lower() else 5  # Access
    score += rec.get("confidence", 0) * 20  # Trust
    return min(100, int(score))

def run():
    raw_records = json.loads(RAW_PATH.read_text())
    
    for rec in raw_records:
        rec["nuview_priority_score"] = calculate_priority(rec)

    canonical = sorted(raw_records, key=lambda x: (-x["nuview_priority_score"], x["agency_name"]))
    
    Path("data/processed").mkdir(parents=True, exist_ok=True)
    CANONICAL_PATH.write_text(json.dumps(canonical, indent=2, ensure_ascii=False))
    
    df = pd.DataFrame(canonical)
    df["rank"] = range(1, len(df) + 1)
    df = df.sort_values("nuview_priority_score", ascending=False)
    df.to_csv(MATRIX_PATH, index=False)
    print(f"Generated matrix: Top score {df.iloc[0]['nuview_priority_score']} ({df.iloc[0]['country']})")

if __name__ == "__main__":
    run()</code></pre>
        </div>

        <h3><i class="bi bi-file-code"></i> 4. Sample Scraper (USGS)</h3>
        <div class="script-description">
            <strong>File:</strong> <code>scripts/scrapers/usgs.py</code><br>
            <strong>Purpose:</strong> Example scraper for US Geological Survey 3DEP program. This pattern can be adapted for other agencies.
        </div>
        <div class="code-block">
            <pre><code class="language-python">import requests
from bs4 import BeautifulSoup
import re
from datetime import datetime
import pdfplumber
from scripts.scrapers.global_keywords import TOPOGRAPHIC_KEYWORDS, BATHY_IGNORE

def scrape() -> list[dict]:
    records = []
    url = "https://www.usgs.gov/news/national-news-release/president-proposes-16-billion-fy-2025-budget-usgs"
    headers = {"User-Agent": "Mozilla/5.0 (compatible; NuViewBot/1.0)"}

    try:
        resp = requests.get(url, headers=headers, timeout=15)
        resp.raise_for_status()
        soup = BeautifulSoup(resp.text, 'html.parser')
        text = soup.get_text()

        budget_match = re.search(r'3DEP.*?\$?([\d,]+(?:\.\d+)?)\s*(million|M)', text, re.I)
        budget_usd = float(budget_match.group(1).replace(',', '')) * 1e6 if budget_match else 43000000

        keywords = list(set(TOPOGRAPHIC_KEYWORDS.findall(text)))
        notes = "USGS 3DEP: Space-based LiDAR for large-area topographic collections. Bare earth DEM focus (QL2 standard)."
        if BATHY_IGNORE.search(text):
            notes += " | Bathymetric component present – excluded from NuView scope"

        records.append({
            "agency_name": "United States Geological Survey",
            "program_name": "3D Elevation Program (3DEP)",
            "country": "United States",
            "fiscal_year": 2026,
            "budget_amount_usd": budget_usd,
            "currency": "USD",
            "program_type": "national_lidar",
            "data_access": "open",
            "sources": [url],
            "document_type": "HTML",
            "scraped_at": datetime.utcnow().isoformat() + "Z",
            "notes": notes,
            "keywords": keywords or ["dem", "bareearth"],
            "confidence": 0.9
        })
    except Exception as e:
        print(f"USGS error: {e}")
        records.append({
            "agency_name": "United States Geological Survey",
            "program_name": "3D Elevation Program (3DEP)",
            "country": "United States",
            "fiscal_year": 2026,
            "budget_amount_usd": 45000000,
            "currency": "USD",
            "program_type": "national_lidar",
            "data_access": "open",
            "sources": [url],
            "document_type": "HTML",
            "scraped_at": datetime.utcnow().isoformat() + "Z",
            "notes": notes,
            "keywords": ["dem", "bareearth"],
            "confidence": 0.8
        })

    return records</code></pre>
        </div>
    </div>

    <div class="section">
        <h2><i class="bi bi-terminal"></i> Usage Instructions</h2>
        
        <div class="info-box">
            <h3>Running the Pipeline</h3>
            <p><strong>Step 1:</strong> Execute all scrapers</p>
            <div class="command-box">python scripts/run_all.py</div>
            
            <p><strong>Step 2:</strong> Validate and merge data</p>
            <div class="command-box">python scripts/qc/validate_and_merge.py</div>
            
            <p><strong>Step 3:</strong> Check the output</p>
            <div class="command-box">cat data/processed/priority_matrix.csv</div>
            
            <p><strong>Result:</strong> The dashboard will automatically render the updated data on the next page load.</p>
        </div>

        <div class="info-box">
            <h3>Adding New Scrapers</h3>
            <p>To add a new scraper for a different agency:</p>
            <ol>
                <li>Create a new Python file in <code>scripts/scrapers/</code> (e.g., <code>new_agency.py</code>)</li>
                <li>Implement a <code>scrape()</code> function that returns a list of dictionaries</li>
                <li>Add the scraper name to the <code>SCRAPERS</code> list in <code>run_all.py</code></li>
                <li>Use the USGS scraper as a template for structure and data format</li>
            </ol>
        </div>
    </div>
</main>

<script>
    // Initialize syntax highlighting
    document.addEventListener('DOMContentLoaded', (event) => {
        document.querySelectorAll('pre code').forEach((block) => {
            hljs.highlightElement(block);
        });
    });
</script>

</body>
</html>
